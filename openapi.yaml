openapi: "3.0.3"
info:
  title: XRPL Issued Currencies Manager API
  version: "0.1.0"
  description: API for managing XRPL issued currencies â€” account generation, trust lines, issuance, and transfers.

servers:
  - url: http://localhost:3000
    description: Local development server

paths:
  /api/ping:
    get:
      summary: Health check
      operationId: ping
      responses:
        "200":
          description: Service is healthy
          content:
            application/json:
              schema:
                type: object
                required: [status]
                properties:
                  status:
                    type: string
                    example: ok

  /api/accounts/generate:
    post:
      summary: Generate and fund a new XRPL account
      operationId: generateAccount
      requestBody:
        required: false
        content:
          application/json:
            schema:
              type: object
              properties:
                network:
                  type: string
                  enum: [testnet, devnet]
                  default: testnet
      responses:
        "201":
          description: Account created and funded
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/GenerateAccountResponse"
        "500":
          description: Server error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ApiError"

  /api/accounts/{address}:
    get:
      summary: Get account info from the ledger
      operationId: getAccountInfo
      parameters:
        - $ref: "#/components/parameters/address"
        - $ref: "#/components/parameters/network"
      responses:
        "200":
          description: Account info
          content:
            application/json:
              schema:
                type: object
                description: Raw account_info result from XRPL
        "404":
          description: Account not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ApiError"
        "500":
          description: Server error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ApiError"

  /api/accounts/{address}/balances:
    get:
      summary: Get XRP and issued currency balances
      operationId: getBalances
      parameters:
        - $ref: "#/components/parameters/address"
        - $ref: "#/components/parameters/network"
      responses:
        "200":
          description: Account balances
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/BalancesResponse"
        "404":
          description: Account not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ApiError"
        "500":
          description: Server error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ApiError"

  /api/accounts/{address}/trustlines:
    get:
      summary: Get trust lines for an account
      operationId: getTrustLines
      parameters:
        - $ref: "#/components/parameters/address"
        - $ref: "#/components/parameters/network"
      responses:
        "200":
          description: Trust lines
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/TrustLinesResponse"
        "404":
          description: Account not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ApiError"
        "500":
          description: Server error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ApiError"
    post:
      summary: Create or modify a trust line
      operationId: setTrustLine
      parameters:
        - $ref: "#/components/parameters/address"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/TrustLineRequest"
      responses:
        "201":
          description: Trust line set successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  result:
                    type: object
                    description: Raw transaction result from XRPL
        "400":
          description: Validation error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ApiError"
        "500":
          description: Server error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ApiError"

  /api/accounts/{address}/transactions:
    get:
      summary: Get transaction history for an account
      operationId: getTransactions
      parameters:
        - $ref: "#/components/parameters/address"
        - $ref: "#/components/parameters/network"
        - name: limit
          in: query
          required: false
          schema:
            type: integer
            default: 20
      responses:
        "200":
          description: Transaction history
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/TransactionsResponse"
        "404":
          description: Account not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ApiError"
        "500":
          description: Server error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ApiError"

  /api/accounts/{address}/credentials:
    get:
      summary: List credentials for an account (XLS-70)
      operationId: getAccountCredentials
      parameters:
        - $ref: "#/components/parameters/address"
        - $ref: "#/components/parameters/network"
        - name: role
          in: query
          required: false
          schema:
            type: string
            enum: [issuer, subject]
          description: Filter by role
      responses:
        "200":
          description: Account credentials
          content:
            application/json:
              schema:
                type: object
                properties:
                  address:
                    type: string
                  credentials:
                    type: array
                    items:
                      $ref: "#/components/schemas/CredentialInfo"
        "404":
          description: Account not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ApiError"
        "500":
          description: Server error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ApiError"

  /api/accounts/{address}/domains:
    get:
      summary: List permissioned domains owned by an account (XLS-80)
      operationId: getAccountDomains
      parameters:
        - $ref: "#/components/parameters/address"
        - $ref: "#/components/parameters/network"
      responses:
        "200":
          description: Account domains
          content:
            application/json:
              schema:
                type: object
                properties:
                  address:
                    type: string
                  domains:
                    type: array
                    items:
                      $ref: "#/components/schemas/DomainInfo"
        "404":
          description: Account not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ApiError"
        "500":
          description: Server error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ApiError"

  /api/accounts/{address}/rippling:
    post:
      summary: Enable DefaultRipple and clear NoRipple on existing trust lines
      operationId: enableRippling
      parameters:
        - $ref: "#/components/parameters/address"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [seed]
              properties:
                seed:
                  type: string
                network:
                  type: string
                  enum: [testnet, devnet]
      responses:
        "200":
          description: Rippling enabled
          content:
            application/json:
              schema:
                type: object
                properties:
                  result:
                    type: object
                    properties:
                      message:
                        type: string
                      trustLinesUpdated:
                        type: integer
        "400":
          description: Validation error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ApiError"
        "500":
          description: Server error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ApiError"

  /api/currencies/issue:
    post:
      summary: Issue currency from issuer to recipient
      operationId: issueCurrency
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/IssueCurrencyRequest"
      responses:
        "201":
          description: Currency issued successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  result:
                    type: object
                    description: Raw transaction result from XRPL
        "400":
          description: Validation error (e.g., missing trust line)
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ApiError"
        "500":
          description: Server error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ApiError"

  /api/transfers:
    post:
      summary: Transfer issued currency between accounts
      operationId: transferCurrency
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/TransferRequest"
      responses:
        "201":
          description: Transfer completed successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  result:
                    type: object
                    description: Raw transaction result from XRPL
        "400":
          description: Validation error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ApiError"
        "500":
          description: Server error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ApiError"

  /api/accounts/{address}/offers:
    get:
      summary: List an account's open DEX offers
      operationId: getAccountOffers
      parameters:
        - $ref: "#/components/parameters/address"
        - $ref: "#/components/parameters/network"
        - name: limit
          in: query
          required: false
          schema:
            type: integer
            default: 200
        - name: marker
          in: query
          required: false
          schema:
            type: string
          description: Opaque pagination marker from a previous response
      responses:
        "200":
          description: Account offers
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AccountOffersResponse"
        "404":
          description: Account not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ApiError"
        "500":
          description: Server error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ApiError"

  /api/dex/offers:
    post:
      summary: Place a DEX offer (OfferCreate)
      operationId: createOffer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateOfferRequest"
      responses:
        "201":
          description: Offer created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  result:
                    type: object
                    description: Raw transaction result from XRPL
        "400":
          description: Validation error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ApiError"
        "500":
          description: Server error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ApiError"

  /api/dex/offers/cancel:
    post:
      summary: Cancel a DEX offer (OfferCancel)
      operationId: cancelOffer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CancelOfferRequest"
      responses:
        "201":
          description: Offer cancelled successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  result:
                    type: object
                    description: Raw transaction result from XRPL
        "400":
          description: Validation error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ApiError"
        "500":
          description: Server error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ApiError"

  /api/dex/orderbook:
    get:
      summary: View order book for a currency pair
      operationId: getOrderBook
      parameters:
        - name: base_currency
          in: query
          required: true
          schema:
            type: string
          description: Base currency code (e.g., "XRP" or "USD")
        - name: base_issuer
          in: query
          required: false
          schema:
            type: string
          description: Base currency issuer (required for non-XRP)
        - name: quote_currency
          in: query
          required: true
          schema:
            type: string
          description: Quote currency code
        - name: quote_issuer
          in: query
          required: false
          schema:
            type: string
          description: Quote currency issuer (required for non-XRP)
        - name: limit
          in: query
          required: false
          schema:
            type: integer
            default: 20
          description: Number of offers per side
        - $ref: "#/components/parameters/network"
        - name: domain
          in: query
          required: false
          schema:
            type: string
          description: Filter by permissioned domain ID
      responses:
        "200":
          description: Order book
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/OrderBookResponse"
        "400":
          description: Validation error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ApiError"
        "500":
          description: Server error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ApiError"

  /api/dex/trades:
    get:
      summary: Recent trades for a currency pair
      operationId: getRecentTrades
      parameters:
        - name: base_currency
          in: query
          required: true
          schema:
            type: string
        - name: base_issuer
          in: query
          required: false
          schema:
            type: string
        - name: quote_currency
          in: query
          required: true
          schema:
            type: string
        - name: quote_issuer
          in: query
          required: false
          schema:
            type: string
        - name: limit
          in: query
          required: false
          schema:
            type: integer
            default: 20
        - name: domain
          in: query
          required: false
          schema:
            type: string
          description: Filter by permissioned domain ID
        - $ref: "#/components/parameters/network"
      responses:
        "200":
          description: Recent trades
          content:
            application/json:
              schema:
                type: object
                properties:
                  base:
                    type: object
                    properties:
                      currency:
                        type: string
                      issuer:
                        type: string
                  quote:
                    type: object
                    properties:
                      currency:
                        type: string
                      issuer:
                        type: string
                  trades:
                    type: array
                    items:
                      type: object
                      properties:
                        side:
                          type: string
                          enum: [buy, sell]
                        price:
                          type: string
                        baseAmount:
                          type: string
                        quoteAmount:
                          type: string
                        account:
                          type: string
                        time:
                          type: string
                        hash:
                          type: string
        "400":
          description: Validation error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ApiError"
        "500":
          description: Server error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ApiError"

  /api/credentials/create:
    post:
      summary: Issue a credential (CredentialCreate)
      operationId: createCredential
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [seed, subject, credentialType]
              properties:
                seed:
                  type: string
                subject:
                  type: string
                credentialType:
                  type: string
                expiration:
                  type: integer
                uri:
                  type: string
                network:
                  type: string
                  enum: [testnet, devnet]
      responses:
        "201":
          description: Credential created
          content:
            application/json:
              schema:
                type: object
                properties:
                  result:
                    type: object
        "400":
          description: Validation error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ApiError"
        "500":
          description: Server error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ApiError"

  /api/credentials/accept:
    post:
      summary: Accept a credential (CredentialAccept)
      operationId: acceptCredential
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [seed, issuer, credentialType]
              properties:
                seed:
                  type: string
                issuer:
                  type: string
                credentialType:
                  type: string
                network:
                  type: string
                  enum: [testnet, devnet]
      responses:
        "201":
          description: Credential accepted
          content:
            application/json:
              schema:
                type: object
                properties:
                  result:
                    type: object
        "400":
          description: Validation error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ApiError"
        "500":
          description: Server error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ApiError"

  /api/credentials/delete:
    post:
      summary: Delete a credential (CredentialDelete)
      operationId: deleteCredential
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [seed, credentialType]
              properties:
                seed:
                  type: string
                subject:
                  type: string
                issuer:
                  type: string
                credentialType:
                  type: string
                network:
                  type: string
                  enum: [testnet, devnet]
      responses:
        "201":
          description: Credential deleted
          content:
            application/json:
              schema:
                type: object
                properties:
                  result:
                    type: object
        "400":
          description: Validation error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ApiError"
        "500":
          description: Server error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ApiError"

  /api/domains/create:
    post:
      summary: Create or update a permissioned domain (PermissionedDomainSet)
      operationId: createDomain
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [seed, acceptedCredentials]
              properties:
                seed:
                  type: string
                domainID:
                  type: string
                  description: Existing domain ID to update (omit to create new)
                acceptedCredentials:
                  type: array
                  minItems: 1
                  maxItems: 10
                  items:
                    type: object
                    required: [issuer, credentialType]
                    properties:
                      issuer:
                        type: string
                      credentialType:
                        type: string
                network:
                  type: string
                  enum: [testnet, devnet]
      responses:
        "201":
          description: Domain created
          content:
            application/json:
              schema:
                type: object
                properties:
                  result:
                    type: object
                  domainID:
                    type: string
                    description: 64-character hex domain ID
        "400":
          description: Validation error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ApiError"
        "500":
          description: Server error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ApiError"

  /api/domains/delete:
    post:
      summary: Delete a permissioned domain (PermissionedDomainDelete)
      operationId: deleteDomain
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [seed, domainID]
              properties:
                seed:
                  type: string
                domainID:
                  type: string
                network:
                  type: string
                  enum: [testnet, devnet]
      responses:
        "201":
          description: Domain deleted
          content:
            application/json:
              schema:
                type: object
                properties:
                  result:
                    type: object
        "400":
          description: Validation error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ApiError"
        "500":
          description: Server error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ApiError"

components:
  parameters:
    address:
      name: address
      in: path
      required: true
      schema:
        type: string
      description: XRPL account address (e.g., rN7n3...)
    network:
      name: network
      in: query
      required: false
      schema:
        type: string
        enum: [testnet, devnet]
        default: testnet

  schemas:
    ApiError:
      type: object
      required: [error]
      properties:
        error:
          type: string

    GenerateAccountResponse:
      type: object
      required: [address, seed, publicKey, balance]
      properties:
        address:
          type: string
        seed:
          type: string
        publicKey:
          type: string
        balance:
          type: string

    CurrencyBalance:
      type: object
      required: [currency, value]
      properties:
        currency:
          type: string
        value:
          type: string
        issuer:
          type: string

    BalancesResponse:
      type: object
      required: [address, balances]
      properties:
        address:
          type: string
        balances:
          type: array
          items:
            $ref: "#/components/schemas/CurrencyBalance"

    TrustLinesResponse:
      type: object
      required: [address, trustLines]
      properties:
        address:
          type: string
        trustLines:
          type: array
          items:
            type: object
            description: Raw trust line object from XRPL

    TransactionsResponse:
      type: object
      required: [address, transactions]
      properties:
        address:
          type: string
        transactions:
          type: array
          items:
            type: object
            description: Raw transaction object from XRPL

    TrustLineRequest:
      type: object
      required: [seed, currency, issuer, limit]
      properties:
        seed:
          type: string
        currency:
          type: string
        issuer:
          type: string
        limit:
          type: string
        network:
          type: string
          enum: [testnet, devnet]

    IssueCurrencyRequest:
      type: object
      required: [issuerSeed, recipientAddress, currencyCode, amount]
      properties:
        issuerSeed:
          type: string
        recipientAddress:
          type: string
        currencyCode:
          type: string
        amount:
          type: string
        network:
          type: string
          enum: [testnet, devnet]

    TransferRequest:
      type: object
      required: [senderSeed, recipientAddress, issuerAddress, currencyCode, amount]
      properties:
        senderSeed:
          type: string
        recipientAddress:
          type: string
        issuerAddress:
          type: string
        currencyCode:
          type: string
        amount:
          type: string
        network:
          type: string
          enum: [testnet, devnet]

    DexAmount:
      type: object
      required: [currency, value]
      properties:
        currency:
          type: string
          description: Currency code ("XRP" or issued currency code)
        issuer:
          type: string
          description: Issuer address (required for non-XRP)
        value:
          type: string
          description: Amount in human-readable units (not drops for XRP)

    OfferFlag:
      type: string
      enum: [passive, immediateOrCancel, fillOrKill, sell]

    CreateOfferRequest:
      type: object
      required: [seed, takerGets, takerPays]
      properties:
        seed:
          type: string
        takerGets:
          $ref: "#/components/schemas/DexAmount"
        takerPays:
          $ref: "#/components/schemas/DexAmount"
        flags:
          type: array
          items:
            $ref: "#/components/schemas/OfferFlag"
        expiration:
          type: integer
          description: Seconds since Ripple Epoch
        offerSequence:
          type: integer
          description: Sequence of an existing offer to replace
        network:
          type: string
          enum: [testnet, devnet]
        domainID:
          type: string
          description: Permissioned domain ID for domain-scoped offers

    CancelOfferRequest:
      type: object
      required: [seed, offerSequence]
      properties:
        seed:
          type: string
        offerSequence:
          type: integer
        network:
          type: string
          enum: [testnet, devnet]

    OrderBookOffer:
      type: object
      properties:
        account:
          type: string
        taker_gets:
          $ref: "#/components/schemas/DexAmount"
        taker_pays:
          $ref: "#/components/schemas/DexAmount"
        quality:
          type: string
        owner_funds:
          type: string
        flags:
          type: integer
        sequence:
          type: integer

    OrderBookResponse:
      type: object
      required: [base, quote, buy, sell]
      properties:
        base:
          type: object
          properties:
            currency:
              type: string
            issuer:
              type: string
        quote:
          type: object
          properties:
            currency:
              type: string
            issuer:
              type: string
        buy:
          type: array
          items:
            $ref: "#/components/schemas/OrderBookOffer"
        sell:
          type: array
          items:
            $ref: "#/components/schemas/OrderBookOffer"
        domain:
          type: string
          description: Permissioned domain ID, echoed back when provided

    AccountOffersResponse:
      type: object
      required: [address, offers]
      properties:
        address:
          type: string
        offers:
          type: array
          items:
            type: object
            properties:
              seq:
                type: integer
              flags:
                type: integer
              taker_gets:
                $ref: "#/components/schemas/DexAmount"
              taker_pays:
                $ref: "#/components/schemas/DexAmount"
              quality:
                type: string
              expiration:
                type: integer
        marker:
          type: string
          description: Pagination marker for the next page

    CredentialInfo:
      type: object
      required: [issuer, subject, credentialType, accepted]
      properties:
        issuer:
          type: string
        subject:
          type: string
        credentialType:
          type: string
        accepted:
          type: boolean
        expiration:
          type: integer
        uri:
          type: string

    DomainInfo:
      type: object
      required: [domainID, owner, acceptedCredentials, sequence]
      properties:
        domainID:
          type: string
          description: 64-character hex domain ID
        owner:
          type: string
        acceptedCredentials:
          type: array
          items:
            type: object
            required: [issuer, credentialType]
            properties:
              issuer:
                type: string
              credentialType:
                type: string
        sequence:
          type: integer
